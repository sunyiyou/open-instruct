{% extends "base.html" %}

{% block title %}Overview - Evaluation Results{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="display-4 mb-3">
            <i class="fas fa-chart-line me-3"></i>
            Evaluation Results Overview
        </h1>
        <p class="lead text-muted">
            Comprehensive view of model evaluation results across all datasets and runs
        </p>
    </div>
</div>

<!-- Summary Statistics -->
<div class="row mb-5">
    <div class="col-md-4">
        <div class="card card-metric text-center">
            <div class="card-body">
                <div class="metric-value">{{ total_models | format_large_number }}</div>
                <div class="metric-label">
                    <i class="fas fa-brain me-1"></i>Models Evaluated
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card card-metric text-center">
            <div class="card-body">
                <div class="metric-value">{{ total_datasets | format_large_number }}</div>
                <div class="metric-label">
                    <i class="fas fa-database me-1"></i>Total Datasets
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card card-metric text-center">
            <div class="card-body">
                <div class="metric-value">{{ total_runs | format_large_number }}</div>
                <div class="metric-label">
                    <i class="fas fa-play me-1"></i>Total Evaluation Runs
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Models Table -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-list me-2"></i>
                    Model Performance Summary
                </h5>
            </div>
            <div class="card-body">
                {% if models %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th><i class="fas fa-brain me-1"></i>Model Name</th>
                                <th class="text-center"><i class="fas fa-database me-1"></i>Datasets</th>
                                <th class="text-center"><i class="fas fa-play me-1"></i>Total Runs</th>
                                <th class="text-center"><i class="fas fa-trophy me-1"></i>Avg Score</th>
                                <th class="text-center"><i class="fas fa-external-link-alt me-1"></i>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for model in models %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-brain text-primary me-2"></i>
                                        <div>
                                            <strong>{{ model.name }}</strong>
                                            <br>
                                            <small class="text-muted">{{ model.dir_name }}</small>
                                        </div>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <span class="badge bg-info">{{ model.num_datasets }}</span>
                                </td>
                                <td class="text-center">
                                    <span class="badge bg-secondary">{{ model.total_runs }}</span>
                                </td>
                                <td class="text-center">
                                    <span class="{% if model.avg_score >= 0.8 %}score-excellent{% elif model.avg_score >= 0.6 %}score-good{% elif model.avg_score >= 0.4 %}score-fair{% elif model.avg_score >= 0.2 %}score-poor{% else %}score-bad{% endif %}">
                                        {{ model.avg_score | round_float(3) }}
                                    </span>
                                    <small class="text-muted">({{ model.avg_score | percentage }})</small>
                                </td>
                                <td class="text-center">
                                    <a href="{{ url_for('model_detail', model_name=model.name) }}" 
                                       class="btn btn-primary btn-sm">
                                        <i class="fas fa-eye me-1"></i>View Details
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No evaluation results found</h5>
                    <p class="text-muted">
                        Run evaluations using <code>eval_code.py</code> to see results here.
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Performance Chart -->
{% if models %}
<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-bar me-2"></i>
                    Model Performance Comparison
                </h5>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
{% if models %}
<script>
// Performance Chart
const ctx = document.getElementById('performanceChart').getContext('2d');
const performanceChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: [
            {% for model in models %}
            "{{ model.name }}"{% if not loop.last %},{% endif %}
            {% endfor %}
        ],
        datasets: [{
            label: 'Average Score',
            data: [
                {% for model in models %}
                {{ model.avg_score }}{% if not loop.last %},{% endif %}
                {% endfor %}
            ],
            backgroundColor: 'rgba(54, 162, 235, 0.8)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                max: 1.0,
                ticks: {
                    callback: function(value) {
                        return (value * 100).toFixed(0) + '%';
                    }
                }
            }
        },
        plugins: {
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return 'Average Score: ' + (context.parsed.y * 100).toFixed(1) + '%';
                    }
                }
            }
        }
    }
});
</script>
{% endif %}
{% endblock %}
